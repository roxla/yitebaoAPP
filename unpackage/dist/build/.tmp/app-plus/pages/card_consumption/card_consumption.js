(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/card_consumption/card_consumption"],{"2e11":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},r=[];a.d(t,"a",function(){return o}),a.d(t,"b",function(){return r})},"425f":function(e,t,a){"use strict";var o=a("f2b4"),r=a.n(o);r.a},"69ac":function(e,t,a){"use strict";a.r(t);var o=a("713d"),r=a.n(o);for(var n in o)"default"!==n&&function(e){a.d(t,e,function(){return o[e]})}(n);t["default"]=r.a},"713d":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){return a.e("components/mx-datepicker/mx-datepicker").then(a.bind(null,"6754"))},r=function(){return a.e("components/uni-segmented-control/uni-segmented-control").then(a.bind(null,"dd25"))},n=function(){return a.e("components/popup-layer/popup-layer").then(a.bind(null,"2854"))},i=function(){return a.e("node-modules/@dcloudio/uni-ui/lib/uni-icon/uni-icon").then(a.bind(null,"6fba"))},c={components:{uniIcon:i,MxDatePicker:o,uniSegmentedControl:r,popupLayer:n},data:function(){return{height:0,items:["卡消费","卡扣款","卡充值"],current:0,showPicker:!1,rangetime:[],value:"",timeSearch:!1,cardNo:"",dataList:[],RecordDt:"",Value:"",fkcardNo:"",infoItem:"",fkOrderNo:"",user_Name:"",shop_tel:"",shop_Name:"",shop_add:"",rechangeInfo:!1,GiveValue:"",payMethod:""}},onLoad:function(t){var a=this.checkLogin("../wallet/wallet",1);this.height=e.getSystemInfoSync().windowHeight,a&&(this.$showLoading(),this.cardNo=t,this.getAllData(t,0))},onPullDownRefresh:function(){this.getAllData(this.cardNo,this.current),this.value="",this.rangetime=[],this.timeSearch=!1,e.stopPullDownRefresh()},methods:{formatDate:function(e){var t=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),r=e.getHours(),n=e.getMinutes(),i=e.getSeconds();return a<10&&(a="0"+a),o<10&&(o="0"+o),r<10&&(r="0"+r),n<10&&(n="0"+n),i<10&&(i="0"+i),t+"-"+a+"-"+o+" "+r+":"+n+":"+i},onClickItem:function(e){this.current!==e&&(this.dataList=[],this.current=e,this.getAllData(this.cardNo,e),this.value="",this.rangetime=[])},onShowDatePicker:function(e){this.showPicker=!0,this.value=this.rangetime},onSelected:function(e){this.showPicker=!1,e&&(this.rangetime=e.value,this.getAllData(this.cardNo,this.current,e.value[0],e.value[1]),this.timeSearch=!0)},getAllData:function(t,a,o,r){var n=this;o||(o=""),r||(r=""),e.request({url:this.apiServer+"userServer/cunUserServer/getCardRecord",method:"POST",data:{cardNo:t.cardId,OpenId:e.getStorageSync("openid"),recordType:a,start:o,end:r},header:{"content-Type":"application/x-www-form-urlencoded"},success:function(t){if(200===t.data.status){var o=t.data.data;switch(a){case 0:for(var r=0;r<o.length;r++){var i=n.formatDate(new Date(o[r].RecordDt));o[r].RecordDt=i,o[r].recordValue||(o[r].recordValue=0),o[r].recordValue=o[r].recordValue.toFixed(2)}n.dataList=o;break;case 1:for(var c=0;c<o.length;c++){var s=n.formatDate(new Date(o[c].RecordDt));o[c].RecordDt=s,o[c].deductionValue||(o[c].deductionValue=0),o[c].deductionValue=o[c].deductionValue.toFixed(2)}n.dataList=o;break;case 2:for(var u=0;u<o.length;u++){var d=n.formatDate(new Date(o[u].rechargeDate));o[u].rechargeDate=d,o[u].rechargeValue||(o[u].rechargeValue=0),o[u].rechargeValue=o[u].rechargeValue.toFixed(2)}n.dataList=o;break;default:console.log("error"," at pages\\card_consumption\\card_consumption.vue:351");break}}else e.showToast({title:t.data.msg,duration:2e3,icon:"none"})},fail:function(){n.reconnect("../wallet/wallet",1)},complete:function(){n.$hideLoading()}})},getUserData:function(t){var a=this;e.request({url:this.apiServer+"shopServer/openWorkerServer/getWorkerData",method:"POST",data:{workerNo:t},header:{"content-Type":"application/x-www-form-urlencoded"},success:function(t){if(200===t.data.status){var o=t.data.data;o&&o.Name?a.user_Name=o.Name:a.user_Name="无"}else e.showToast({title:t.data.msg,duration:2e3,icon:"none"})}})},getShopData:function(t){var a=this;e.request({url:this.apiServer+"shopServer/openShopServer/getShopData",method:"POST",data:{shopNo:t},header:{"content-Type":"application/x-www-form-urlencoded"},success:function(t){if(200===t.data.status){var o=t.data.data;o?(o.shopAdd?a.shop_add=o.shopAdd:a.shop_add="无",o.contectTel?a.shop_tel=o.contectTel:a.shop_tel="无",o.Name?a.shop_Name=o.Name:a.shop_Name="无"):(a.shop_add="无",a.shop_tel="无",a.shop_Name="无")}else e.showToast({title:t.data.msg,duration:2e3,icon:"none"})}})},getInfo:function(e){switch(this.fkcardNo=e.cardNumber,this.getUserData(e.workerNo),this.getShopData(e.shopNo),this.current){case 0:this.infoItem="洗护单号",this.Value=e.recordValue,this.fkOrderNo=e.orderNo,this.RecordDt=e.RecordDt,this.rechangeInfo=!1;break;case 1:this.infoItem="余额",e.afterBlance||(e.afterBlance=0),this.fkOrderNo=e.afterBlance.toFixed(2)+" 元",this.Value=e.deductionValue,this.RecordDt=e.RecordDt,this.rechangeInfo=!1;break;case 2:switch(this.infoItem="余额",e.afterBlance||(e.afterBlance=0),e.GiveValue||(e.GiveValue=0),this.GiveValue=e.GiveValue.toFixed(2),e.payMethod){case 0:this.payMethod="现金";break;case 1:this.payMethod="微信";break;case 2:this.payMethod="支付宝";break;case 3:this.payMethod="使用积分充值";break;case 4:this.payMethod="微信刷卡支付";break;case 5:this.payMethod="支付宝当面付";break}this.fkOrderNo=e.afterBlance.toFixed(2)+" 元",this.Value=e.rechargeValue,this.RecordDt=e.rechargeDate,this.rechangeInfo=!0;break;default:console.log("error"," at pages\\card_consumption\\card_consumption.vue:504");break}this.$refs.popupRef.show()},close:function(e){this.$refs.popupRef.close()}}};t.default=c}).call(this,a("6e42")["default"])},f2b4:function(e,t,a){},f658:function(e,t,a){"use strict";a.r(t);var o=a("2e11"),r=a("69ac");for(var n in r)"default"!==n&&function(e){a.d(t,e,function(){return r[e]})}(n);a("425f");var i=a("2877"),c=Object(i["a"])(r["default"],o["a"],o["b"],!1,null,"4610726f",null);t["default"]=c.exports}},[["1e4f","common/runtime","common/vendor"]]]);